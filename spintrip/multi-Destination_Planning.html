<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Multi-Destination</title>
		<link rel="stylesheet" href="style.css">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Antic+Slab&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    

		<!-- Loads Bootstrap CSS for styling -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css"/>

		<!-- Loads a library to convert text into formatted HTML -->
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<style>
			#response {
				margin-top: 20px;
				padding: 10px;
				min-height: 50px;
			}
			#response h3 {
				color: #5a5656;
				font-size: 1.2em;
			}
			#response strong {
				color: #d9534f;
			}
			#response ul {
				padding-left: 20px;
			}
			#response li {
				margin-bottom: 5px;
			}

			h2{
				text-align: center;
			}

			input, select, button { 
				display: flex; 
				margin: 10px 0; 
				padding: 8px; 
				width: 600px;
				justify-content: center; 
				align-items: center; 
				place-items: center;
			}

			.form-control { 
				display: block; 
				width: 600px; 
				margin: 10px 0; 
				padding: 8px; 
				background-color: rgb(218, 245, 222);
				border-radius: 20px;
				border: 1px rgb(163, 227, 174) solid;
			}

			#userInput, .btn-success{

				margin-left: -12px;
			}

			.btn-success, .btn-primary{
				background: #A3E3AE;
				background: #A3E3AE; 
				color: black; 
				font-weight: bold;
				border: none; 
				cursor: pointer; 
				border-radius: 20px;
				border: 1px rgb(163, 227, 174) solid;
			
			}

			.btn-success:hover, .btn-primary:hover{
				background: #81e592;
				color: black; 
			}

			.preferences{
				font-weight: bold;
			}
 
		</style>
	</head>
	<body>

		<div class="header">
            <img src="images/bg_logo.png" class="logo" alt="Logo">
            <div class="nav-links">
                <a href="index.html">Homepage</a>
                <a href="./customizable_Trip_Planning.html">Trip Planning</a>
                <a href="./budget_Estimator.html">Budget Estimator</a>
                <a href="./multi-Destination_Planning.html">Multi-Destination</a>
                <a href="./travel_preference_form.html">Preference</a>
                <!-- <a href="./plan.html">Plan</a> -->
                <a href="./login.html">Login</a>
            </div>
        </div>

		<div>
			<div class="container">
			<h2>Multi-Destination Trip Planner</h2>
				
			<div class="form-group">
				<input type="text" class="form-control" id="destinationInput" placeholder="Enter a destination where you want to go" />
			</div>

			<!-- Button to add the entered destination to the list -->
			<button class="btn-primary" onclick="addDestination()">Add Destination</button>
				
			<!-- Displays the list of added destinations -->
			<div class="destination-list" id="destinationList"></div>
				
			<!-- Dropdown for selecting travel preferences -->
			<div class="form-group">
				<label for="preferences" class="preferences">Preferences:</label>
				<select class="form-control" id="preferences" onchange="updateTransitOptions()">
					<option value="cost">Cost</option>
					<option value="time">Time</option>
					<option value="environment">Environmental Impact</option>
				</select>
			</div>
				
			<!-- Displays transit options based on the selected preferences -->
			<div id="transitOptions"></div>

			<div class="container">
				<div class="form-group">
					<input type="text" class="form-control" id="userInput" placeholder="Enter your question here" />
				</div>
				<button class="btn-success" onclick="sendMessage()">Press Button</button>
				<div id="response"></div>
			</div>
		</div>


		<script>

		 // Stores the list of destinations entered by the user
		let destinations = [];
        let transitOptions = [];

		// Function to add a destination to the list
        function addDestination() {
            const destinationInput = document.getElementById('destinationInput');
            const destination = destinationInput.value.trim();
            if (destination) {
                destinations.push(destination);	// Adds destination to the list
                destinationInput.value = '';	// Clears input field after adding
                renderDestinations();	// Updates the displayed list
                updateTransitOptions(); // Updates transit options
            }
        }

		 // Function to remove a destination from the list
        function removeDestination(index) {
            destinations.splice(index, 1);	// Removes destination by index
            renderDestinations();	 // Updates the displayed list
            updateTransitOptions();	 // Updates transit options
        }

		// Function to reorder destinations in the list
        function reorderDestination(fromIndex, toIndex) {
            const [removed] = destinations.splice(fromIndex, 1);	// Removes destination
            destinations.splice(toIndex, 0, removed);				// Inserts it at a new position
            renderDestinations();			// Updates the displayed list
            updateTransitOptions();			// Updates transit options
        }

		// Function to display the list of added destinations
        function renderDestinations() {
            const destinationList = document.getElementById('destinationList');
            destinationList.innerHTML = '';
            destinations.forEach((destination, index) => {
                const destinationItem = document.createElement('div');
                destinationItem.className = 'destination-item';
                destinationItem.innerHTML = `
                    <span>${destination}</span>
                    <div>
                        <button class="btn btn-sm btn-danger" onclick="removeDestination(${index})">Remove</button>
                        <button class="btn btn-sm btn-secondary" onclick="moveUp(${index})">Up</button>
                        <button class="btn btn-sm btn-secondary" onclick="moveDown(${index})">Down</button>
                    </div>
                `;
                destinationList.appendChild(destinationItem);	// Adds item to the list
            });
        }

		// Function to move a destination up in the list
        function moveUp(index) {
            if (index > 0) {
                reorderDestination(index, index - 1);
            }
        }

		  // Function to move a destination down in the list
        function moveDown(index) {
            if (index < destinations.length - 1) {
                reorderDestination(index, index + 1);
            }
        }

		// Function to update transit options based on the selected preference
        function updateTransitOptions() {
            const preference = document.getElementById('preferences').value;
            // Simulate API call to get transit options based on destinations and preference
            transitOptions = getTransitOptions(destinations, preference);
            renderTransitOptions();
        }

        function getTransitOptions(destinations, preference) {
            // Simulated transit options based on preference
            const options = [];
            destinations.forEach((destination, index) => {
                if (index < destinations.length - 1) {
                    const nextDestination = destinations[index + 1];
                    options.push({
                        from: destination,
                        to: nextDestination,
                        options: [
                            { mode: 'Flight', time: '2h', cost: '$200', impact: 'High' },
                            { mode: 'Train', time: '4h', cost: '$100', impact: 'Medium' },
                            { mode: 'Bus', time: '6h', cost: '$50', impact: 'Low' }
                        ]
                    });
                }
            });
            return options;
        }

        function renderTransitOptions() {

			// Get the div element where the transit options will be displayed
            const transitOptionsDiv = document.getElementById('transitOptions');

			// Clear any existing content in the transit options section
            transitOptionsDiv.innerHTML = '';

			// Loop through each transit option to create and display travel details
            transitOptions.forEach((option, index) => {

				 // Create a new div element to hold the transit option details
                const optionDiv = document.createElement('div');

				// Assign a CSS class to style the transit option
                optionDiv.className = 'transit-option';

				 // Generate the HTML content for the transit option
                optionDiv.innerHTML = `
                    <h3>${option.from} to ${option.to}</h3>
                    <ul>
                        ${option.options.map(opt => `
                            <li>
                                <strong>${opt.mode}</strong> - Time: ${opt.time}, Cost: ${opt.cost}, Environmental Impact: ${opt.impact}
                            </li>
                        `).join('')}
                    </ul>
                `;

				// Add the generated transit option element to the transit options section
                transitOptionsDiv.appendChild(optionDiv);
            });
        }

		// Asynchronous function to send a message and fetch response from an API
		async function sendMessage() {

			// Get the user input value from the input field
			const input = document.getElementById('userInput').value;

			// Get the response display div
			const responseDiv = document.getElementById('response');

			// If the input is empty, display an error message and exit the function
			if (!input) {
				responseDiv.innerHTML = 'Please enter your place of origin and destination.';
				return;
			}

			// Show a loading message while waiting for the response
			responseDiv.innerHTML = 'Loading...';
			try {

				// Send a POST request to the API
				const response = await fetch(
					'https://openrouter.ai/api/v1/chat/completions',
					{
						method: 'POST',
						headers: {
							Authorization: '******************************************************',
							'HTTP-Referer': 'https://www.sitename.com',
							'X-Title': 'SiteName',
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({
							model: 'deepseek/deepseek-r1:free',
							messages: [{ role: 'user', content: input }],
						}),
					},
				);
				// Convert the API response to JSON format
					console.log(data);

				// Extract the message content from the response, or show an error if unavailable
				const markdownText =
					data.choices?.[0]?.message?.content || 'No response received.';

					// Convert the markdown response to HTML and display it
				responseDiv.innerHTML = marked.parse(markdownText);
			} catch (error) {

				// Display an error message if the API request fails
				responseDiv.innerHTML = 'Error: ' + error.message;
			}
		}
		</script>
	</body>

</html>
